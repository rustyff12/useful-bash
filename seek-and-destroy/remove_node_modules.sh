#!/bin/bash

# Set the root directory (defaults to current if none given)
ROOT_DIR="${1:-.}"


clean_node_modules() {
    local dir="$1"

    IFS=$'\n'
    for entry in "$dir"/*; do
        [ -e "$entry" ] || continue
        local basename
        basename="$(basename "$entry")"

        if [[ "$basename" == "node_modules" && -d "$entry" ]]; then
            local parent_dir
            parent_dir="$(dirname "$entry")"
            echo "Found node_modules in: $entry"
            echo "Deleting: $entry"
            rm -rf "$entry"
            return  # Skip further descent in this branch
        fi

        # Recurse if it's a directory
        if [[ -d "$entry" ]]; then
            clean_node_modules "$entry"
        fi
    done
    unset IFS
}

echo "Scanning and cleaning node_modules in: $ROOT_DIR"
clean_node_modules "$ROOT_DIR"
